<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FactoryOne - Ultimate (Thai Commented)</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì¶</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Tailwind ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Dark Mode ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Inter
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'] } } }
        }
    </script>

    <style>
        /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Scrollbar ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏ó‡πà‡∏á‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏ó‡∏∑‡πà‡∏≠‡πÜ */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        
        /* Animation: Effect ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ (Fade In / Scale In) */
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        .scale-in { animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÑ‡∏î‡πâ (Sortable) */
        .sort-header { cursor: pointer; user-select: none; transition: color 0.2s; }
        .sort-header:hover { color: #3b82f6; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans transition-colors duration-200 overflow-hidden selection:bg-blue-100 dark:selection:bg-blue-900">

    <div id="login-screen" class="fixed inset-0 z-[100] bg-slate-900 flex items-center justify-center transition-opacity duration-500">
        <div class="bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-2xl w-full max-w-md border border-slate-700/50 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 to-purple-600"></div>
            <div class="w-20 h-20 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg shadow-blue-500/50">
                <i class="fa-solid fa-cube text-4xl text-white"></i>
            </div>
            <h1 class="text-3xl font-bold text-slate-800 dark:text-white mb-2">FactoryOne</h1>
            <p class="text-slate-500 dark:text-slate-400 mb-8">Ultimate Management v2.0</p>
            
            <form onsubmit="event.preventDefault(); handleLogin();" class="space-y-4 text-left">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Username</label>
                    <input type="text" id="login-user" class="w-full px-4 py-3 rounded-xl border dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 dark:text-white outline-none focus:ring-2 focus:ring-blue-500 transition" placeholder="admin" value="admin">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Password</label>
                    <input type="password" id="login-pass" class="w-full px-4 py-3 rounded-xl border dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50 dark:text-white outline-none focus:ring-2 focus:ring-blue-500 transition" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="1234">
                </div>
                <button type="submit" class="w-full py-3.5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-500/30 transition transform active:scale-95 mt-4">
                    Login System
                </button>
            </form>
            <p class="mt-6 text-xs text-slate-400">Default: admin / 1234</p>
        </div>
    </div>

    <div id="app-root" class="flex h-screen">
        
        <aside id="sidebar" class="bg-slate-900 text-white w-72 flex-shrink-0 flex flex-col transition-all duration-300 fixed md:static inset-y-0 left-0 z-50 transform -translate-x-full md:translate-x-0 shadow-2xl">
            <div class="h-20 flex items-center gap-3 px-6 border-b border-slate-800 bg-slate-900">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 to-blue-500 flex items-center justify-center shadow-lg shadow-blue-900/50">
                    <i class="fa-solid fa-cube text-xl text-white"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg tracking-wide">FactoryOne</h1>
                    <p class="text-xs text-slate-400">v2.0 Ultimate</p>
                </div>
            </div>
            
            <nav class="flex-1 p-4 space-y-2 overflow-y-auto" id="nav-container"></nav>
            
            <div class="px-4 pb-2">
                <button onclick="factoryReset()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 text-red-400 hover:bg-red-500/10 hover:text-red-300 group">
                    <i class="fa-solid fa-power-off w-5 text-center group-hover:rotate-90 transition-transform"></i> 
                    <span class="font-medium text-sm">Reset System</span>
                </button>
            </div>
            
            <div class="p-4 border-t border-slate-800 bg-slate-900">
                <div class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 transition border border-slate-700/50">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center font-bold text-sm shadow-md">AD</div>
                    <div>
                        <p class="text-sm font-semibold">Admin User</p>
                        <p class="text-xs text-slate-400">System Manager</p>
                    </div>
                </div>
            </div>
        </aside>

        <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-40 hidden md:hidden backdrop-blur-sm transition-opacity"></div>

        <main class="flex-1 flex flex-col h-screen overflow-hidden relative w-full bg-slate-50 dark:bg-slate-900 transition-colors duration-200">
            <header class="h-20 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between px-6 lg:px-8 z-30 transition-colors shadow-sm">
                <div class="flex items-center gap-4">
                    <button onclick="toggleSidebar()" class="md:hidden p-2 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition"><i class="fa-solid fa-bars text-xl"></i></button>
                    <h2 id="page-title" class="text-2xl font-bold text-slate-800 dark:text-white transition-colors tracking-tight">Dashboard</h2>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="toggleDarkMode()" class="p-2.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 transition border border-transparent hover:border-slate-200 dark:hover:border-slate-600">
                        <i class="fa-solid fa-moon dark:hidden"></i>
                        <i class="fa-solid fa-sun hidden dark:inline text-yellow-400"></i>
                    </button>
                    <button onclick="toggleNotif()" class="relative p-2.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 transition border border-transparent hover:border-slate-200 dark:hover:border-slate-600">
                        <i class="fa-solid fa-bell text-lg"></i>
                        <span class="absolute top-2 right-2.5 w-2 h-2 bg-red-500 rounded-full border-2 border-white dark:border-slate-800 animate-pulse"></span>
                    </button>
                </div>
            </header>

            <div id="notif-dropdown" class="hidden absolute top-20 right-6 w-80 bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-100 dark:border-slate-700 z-50 overflow-hidden scale-in origin-top-right">
                <div class="p-4 border-b border-slate-100 dark:border-slate-700 font-bold dark:text-white flex justify-between items-center">
                    <span>Notifications</span>
                    <span class="text-xs font-normal text-blue-500 cursor-pointer">Mark all read</span>
                </div>
                <div class="max-h-80 overflow-y-auto">
                    <div class="p-4 border-b border-slate-50 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition cursor-pointer group">
                        <div class="flex gap-3">
                            <div class="text-orange-500 bg-orange-100 dark:bg-orange-900/30 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"><i class="fa-solid fa-triangle-exclamation text-xs"></i></div>
                            <div>
                                <p class="text-sm font-medium text-slate-800 dark:text-slate-200 group-hover:text-blue-600 transition-colors">System Update v2.0</p>
                                <p class="text-xs text-slate-500 mt-1">Just now</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="content-area" class="flex-1 overflow-y-auto p-4 lg:p-8 relative scroll-smooth"></div>
        </main>
    </div>

    <div id="modal-form" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[60] hidden flex items-center justify-center p-4 fade-in">
        <div class="bg-white dark:bg-slate-800 rounded-2xl w-full max-w-lg shadow-2xl scale-in overflow-hidden transition-colors border border-slate-100 dark:border-slate-700">
            <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50/50 dark:bg-slate-800">
                <h3 id="modal-title" class="text-xl font-bold text-slate-800 dark:text-white">Add New Item</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-red-500 transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <form onsubmit="event.preventDefault(); handleFormSubmit();" class="p-6 space-y-5">
                <input type="hidden" id="inp-id">
                
                <div>
                    <label class="block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1.5">Item Name</label>
                    <input type="text" id="inp-name" required class="w-full px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="e.g. Steel Plate">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1.5">SKU</label>
                        <input type="text" id="inp-sku" required class="w-full px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="XYZ-001">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1.5">Location</label>
                        <input type="text" id="inp-loc" required class="w-full px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="Zone A">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1.5">Stock</label>
                        <input type="number" id="inp-stock" required class="w-full px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" value="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1.5">Min Level</label>
                        <input type="number" id="inp-min" required class="w-full px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" value="10">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1.5">Unit</label>
                        <select id="inp-unit" class="w-full px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                            <option value="pcs">Pcs</option>
                            <option value="kg">Kg</option>
                            <option value="L">Liter</option>
                            <option value="box">Box</option>
                            <option value="roll">Roll</option>
                            <option value="pair">Pair</option>
                        </select>
                    </div>
                </div>
                <div class="pt-4 flex gap-3">
                    <button type="button" onclick="closeModal()" class="flex-1 py-3 rounded-xl border border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 transition font-medium">Cancel</button>
                    <button type="submit" class="flex-1 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-medium shadow-lg shadow-blue-500/30 transition transform active:scale-95">Save Item</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toast" class="fixed top-6 right-6 z-[70] bg-white dark:bg-slate-800 border-l-4 border-green-500 pl-4 pr-6 py-4 rounded-lg shadow-2xl transform translate-x-[150%] transition-transform duration-500 flex items-center gap-4">
        <div class="bg-green-100 dark:bg-green-900/50 p-2 rounded-full text-green-600 dark:text-green-400"><i class="fa-solid fa-check"></i></div>
        <div>
            <h4 class="font-bold text-slate-800 dark:text-white text-sm" id="toast-title">Success</h4>
            <p id="toast-msg" class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">Operation completed.</p>
        </div>
    </div>

    <script>
        // ==========================================
        // SECTION 1: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Store)
        // ==========================================
        
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
        const defaultInv = [
            { id: 1, name: 'Steel Plate A4', sku: 'STL-A4', stock: 45, min: 50, unit: 'pcs', loc: 'Zone A' },
            { id: 2, name: 'Hydraulic Oil', sku: 'OIL-15W', stock: 120, min: 30, unit: 'L', loc: 'Zone B' },
            { id: 3, name: 'Copper Wire', sku: 'CPR-02', stock: 5, min: 20, unit: 'roll', loc: 'Zone A' },
            { id: 4, name: 'Circuit Board', sku: 'PCB-X1', stock: 200, min: 100, unit: 'pcs', loc: 'Zone C' },
            { id: 5, name: 'Safety Gloves', sku: 'SAF-G', stock: 12, min: 20, unit: 'pair', loc: 'Zone S' }
        ];
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LocalStorage (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ defaultInv)
        let inventory = JSON.parse(localStorage.getItem('factory_inv_v2')) || defaultInv;
        // ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Logs)
        let activityLogs = JSON.parse(localStorage.getItem('factory_logs_v2')) || [];
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤ Dark Mode
        let isDarkMode = localStorage.getItem('darkMode') === 'true';

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á (Filter) ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö (Sort)
        let filterStatus = 'all'; // ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ: all, normal, low, out
        let sortConfig = { key: 'id', direction: 'desc' }; // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° ID, ‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢

        // ==========================================
        // SECTION 2: ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (Authentication)
        // ==========================================
        function handleLogin() {
            const u = document.getElementById('login-user').value;
            const p = document.getElementById('login-pass').value;
            const screen = document.getElementById('login-screen');
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ (Mockup)
            if(u === 'admin' && p === '1234') {
                // ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login
                screen.classList.add('opacity-0', 'pointer-events-none');
                setTimeout(() => screen.remove(), 500); // ‡∏•‡∏ö Element ‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î RAM
                init(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å
            } else {
                alert('‚ùå Incorrect Password! (Try: admin / 1234)');
            }
        }

        // ==========================================
        // SECTION 3: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Initialization)
        // ==========================================
        function init() {
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Dark Mode ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
            if(isDarkMode) document.documentElement.classList.add('dark');
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π Sidebar
            renderNav();
            // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô Dashboard
            router('dashboard');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô)
        function factoryReset() {
            if(confirm('‚ö†Ô∏è WARNING: This will delete ALL data. Continue?')) {
                localStorage.removeItem('factory_inv_v2');
                localStorage.removeItem('factory_logs_v2');
                location.reload(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö Dark/Light Mode
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', isDarkMode);
            // ‡∏ñ‡πâ‡∏≤‡∏£‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Dashboard ‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°)
            if(currRoute === 'dashboard') router('dashboard'); 
        }

        // ==========================================
        // SECTION 4: ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (Routing)
        // ==========================================
        const routes = [
            { id: 'dashboard', label: 'Dashboard', icon: 'fa-chart-pie' },
            { id: 'inventory', label: 'Inventory', icon: 'fa-boxes-stacked' },
            { id: 'production', label: 'Production', icon: 'fa-industry' },
            { id: 'barcode', label: 'Scanner', icon: 'fa-barcode' },
        ];
        let currRoute = 'dashboard';

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏≤‡∏Å Array ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
        function renderNav() {
            document.getElementById('nav-container').innerHTML = routes.map(r => `
                <button onclick="router('${r.id}')" id="btn-${r.id}" class="w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 text-slate-400 hover:bg-slate-800 hover:text-white group">
                    <i class="fa-solid ${r.icon} w-6 text-center group-hover:scale-110 transition-transform"></i> 
                    <span class="font-medium tracking-wide">${r.label}</span>
                </button>
            `).join('');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ß‡πá‡∏ö)
        function router(id) {
            currRoute = id;
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥
            document.querySelectorAll('nav button').forEach(b => b.className = "w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 text-slate-400 hover:bg-slate-800 hover:text-white group");
            // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏™‡∏µ‡∏ü‡πâ‡∏≤)
            document.getElementById(`btn-${id}`).className = "w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 bg-blue-600 text-white shadow-lg shadow-blue-900/50 group";
            
            // ‡∏õ‡∏¥‡∏î Sidebar (‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)
            document.getElementById('sidebar-overlay').classList.add('hidden');
            document.getElementById('sidebar').classList.add('-translate-x-full');
            document.getElementById('sidebar').classList.remove('translate-x-0');

            const container = document.getElementById('content-area');
            const title = document.getElementById('page-title');
            
            // Logic ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤
            if(id === 'dashboard') { title.innerText = 'Dashboard Overview'; renderDashboard(container); }
            else if(id === 'inventory') { title.innerText = 'Inventory Management'; renderInventory(container); }
            else if(id === 'production') { title.innerText = 'Production Monitor'; renderProduction(container); }
            else if(id === 'barcode') { title.innerText = 'Scanner Terminal'; renderBarcode(container); }
        }

        // ==========================================
        // SECTION 5: ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Renderers)
        // ==========================================

        // === ‡∏´‡∏ô‡πâ‡∏≤ DASHBOARD ===
        function renderDashboard(el) {
            const lowStock = inventory.filter(i => i.stock < i.min).length;
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (Logs) 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            const logRows = activityLogs.slice(0, 5).map(log => `
                <div class="flex items-start justify-between p-3 bg-slate-50 dark:bg-slate-700/30 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center text-xs"><i class="fa-solid fa-clock-rotate-left"></i></div>
                        <div>
                            <p class="text-sm font-bold text-slate-700 dark:text-slate-200">${log.action}</p>
                            <p class="text-xs text-slate-500 dark:text-slate-400">${log.desc}</p>
                        </div>
                    </div>
                    <p class="text-xs font-mono text-slate-400">${log.time}</p>
                </div>
            `).join('');

            // HTML ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Dashboard
            el.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 fade-in">
                    ${statCard('Total Inventory', inventory.length, 'Items', 'fa-box', 'blue')}
                    ${statCard('Efficiency', '92%', 'OEE', 'fa-chart-line', 'green')}
                    ${statCard('Low Stock Alerts', lowStock, 'Items', 'fa-triangle-exclamation', 'orange')}
                    ${statCard('Active Machines', '3/4', 'Running', 'fa-gears', 'purple')}
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 fade-in">
                    <div class="lg:col-span-2 bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                        <h3 class="font-bold text-lg text-slate-700 dark:text-white mb-6">Production Output</h3>
                        <div class="h-72"><canvas id="chartProd"></canvas></div>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                        <h3 class="font-bold text-lg text-slate-700 dark:text-white mb-6">Stock Status</h3>
                        <div class="h-56 flex justify-center"><canvas id="chartInv"></canvas></div>
                    </div>
                    <div class="lg:col-span-3 bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-lg text-slate-700 dark:text-white">Recent Activity</h3>
                            <button onclick="clearLogs()" class="text-xs text-red-400 hover:text-red-500">Clear History</button>
                        </div>
                        <div class="space-y-3">${activityLogs.length ? logRows : '<p class="text-slate-400 text-sm text-center">No recent activity</p>'}</div>
                    </div>
                </div>`;
            
            // ‡∏£‡∏≠ 50ms ‡πÉ‡∏´‡πâ HTML ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏≠‡∏¢‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü
            setTimeout(() => initCharts(lowStock), 50);
        }

        // Helper ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏•‡∏î‡πÇ‡∏Ñ‡πâ‡∏î‡∏ã‡πâ‡∏≥)
        function statCard(label, val, unit, icon, color) {
            const c = { blue: 'from-blue-500 to-blue-600', green: 'from-green-500 to-green-600', orange: 'from-orange-500 to-orange-600', purple: 'from-purple-500 to-purple-600' };
            return `<div class="bg-gradient-to-br ${c[color]} text-white p-6 rounded-2xl shadow-lg relative overflow-hidden group hover:-translate-y-1 transition-transform">
                <div class="relative z-10"><p class="opacity-80 font-medium text-sm">${label}</p><h3 class="text-3xl font-bold mt-1">${val} <span class="text-sm font-normal opacity-70">${unit}</span></h3></div>
                <i class="fa-solid ${icon} absolute -bottom-4 -right-4 text-8xl opacity-10 group-hover:scale-110 group-hover:rotate-12 transition-transform"></i>
            </div>`;
        }

        // === ‡∏´‡∏ô‡πâ‡∏≤ INVENTORY (‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ===
        function renderInventory(el) {
            el.innerHTML = `
                <div class="space-y-6 fade-in">
                    <div class="flex flex-col xl:flex-row justify-between gap-4">
                        <div class="flex flex-col sm:flex-row gap-4 w-full xl:w-auto">
                            <div class="relative flex-1 sm:w-80 group">
                                <i class="fa-solid fa-search absolute left-4 top-3.5 text-slate-400 group-focus-within:text-blue-500 transition-colors"></i>
                                <input type="text" id="search" onkeyup="renderInvTable()" placeholder="Search Name or SKU..." class="w-full pl-11 pr-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-shadow shadow-sm">
                            </div>
                            <div class="relative w-full sm:w-48">
                                <i class="fa-solid fa-filter absolute left-4 top-3.5 text-slate-400"></i>
                                <select id="filter-status" onchange="handleFilterChange(this.value)" class="w-full pl-11 pr-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none appearance-none cursor-pointer">
                                    <option value="all">All Status</option>
                                    <option value="normal">‚úÖ Normal</option>
                                    <option value="low">‚ö†Ô∏è Low Stock</option>
                                    <option value="out">‚ùå Out of Stock</option>
                                </select>
                                <i class="fa-solid fa-chevron-down absolute right-4 top-4 text-slate-400 text-xs pointer-events-none"></i>
                            </div>
                        </div>
                        <div class="flex gap-3 w-full xl:w-auto">
                            <button onclick="exportCSV()" class="px-5 py-3 border border-slate-200 dark:border-slate-600 text-slate-600 dark:text-slate-300 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition flex items-center gap-2 font-medium">
                                <i class="fa-solid fa-file-csv"></i> <span class="hidden sm:inline">Export</span>
                            </button>
                            <button onclick="openModal()" class="flex-1 sm:flex-none px-5 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 shadow-lg shadow-blue-500/30 transition flex items-center justify-center gap-2 font-medium">
                                <i class="fa-solid fa-plus"></i> Add Item
                            </button>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700">
                                    <tr>
                                        ${th('name', 'Item Details')}
                                        ${th('stock', 'Stock')}
                                        ${th('status', 'Status')}
                                        <th class="px-6 py-4 font-semibold text-slate-500 dark:text-slate-400 text-xs uppercase tracking-wider">Location</th>
                                        <th class="px-6 py-4 text-right font-semibold text-slate-500 dark:text-slate-400 text-xs uppercase tracking-wider">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="inv-body" class="divide-y divide-slate-100 dark:divide-slate-700"></tbody>
                            </table>
                        </div>
                    </div>
                </div>`;
            renderInvTable(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        }

        // Helper ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏Å‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ (Sortable Header)
        function th(key, label) {
            let icon = '';
            // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ô‡∏µ‡πâ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏π‡∏Å‡∏®‡∏£
            if (sortConfig.key === key) {
                icon = sortConfig.direction === 'asc' ? '<i class="fa-solid fa-arrow-up sort-icon"></i>' : '<i class="fa-solid fa-arrow-down sort-icon"></i>';
            }
            return `<th onclick="handleSort('${key}')" class="px-6 py-4 font-semibold text-slate-500 dark:text-slate-400 text-xs uppercase tracking-wider sort-header select-none">${label} ${icon}</th>`;
        }

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤ Filter
        function handleFilterChange(val) {
            filterStatus = val;
            renderInvTable(); // ‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
        }

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
        function handleSort(key) {
            // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏ã‡πâ‡∏≥‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏î‡∏¥‡∏° ‡πÉ‡∏´‡πâ‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á (asc <-> desc)
            if (sortConfig.key === key) {
                sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
            } else {
                // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà asc
                sortConfig.key = key;
                sortConfig.direction = 'asc';
            }
            renderInvTable();
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Render Logic)
        function renderInvTable() {
            const term = document.getElementById('search')?.value.toLowerCase() || '';
            const tbody = document.getElementById('inv-body');

            // 1. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á (Filter)
            let filtered = inventory.filter(i => {
                const textMatch = i.name.toLowerCase().includes(term) || i.sku.toLowerCase().includes(term);
                let statusMatch = true;
                if(filterStatus === 'low') statusMatch = i.stock < i.min && i.stock > 0;
                else if(filterStatus === 'out') statusMatch = i.stock === 0;
                else if(filterStatus === 'normal') statusMatch = i.stock >= i.min;
                return textMatch && statusMatch;
            });

            // 2. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö (Sort)
            filtered.sort((a, b) => {
                let valA, valB;
                // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° Status ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
                if(sortConfig.key === 'status') {
                    const getStatusVal = (item) => item.stock === 0 ? 0 : (item.stock < item.min ? 1 : 2);
                    valA = getStatusVal(a);
                    valB = getStatusVal(b);
                } else {
                    valA = a[sortConfig.key];
                    valB = b[sortConfig.key];
                }

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô String ‡∏´‡∏£‡∏∑‡∏≠ Number
                if (typeof valA === 'string') {
                    return sortConfig.direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
                }
                return sortConfig.direction === 'asc' ? valA - valB : valB - valA;
            });

            // 3. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î HTML
            if(filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-12 text-center text-slate-400"><i class="fa-solid fa-box-open text-4xl mb-3 opacity-20 block"></i>No items match criteria.</td></tr>`;
                return;
            }

            // Loop ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏ó‡∏µ‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß
            tbody.innerHTML = filtered.map(i => `
                <tr class="hover:bg-blue-50/50 dark:hover:bg-slate-700/30 transition group">
                    <td class="px-6 py-4">
                        <div class="font-bold text-slate-800 dark:text-white">${i.name}</div>
                        <div class="text-xs text-slate-400 font-mono">${i.sku}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-mono text-slate-700 dark:text-slate-300 font-medium">${i.stock} <span class="text-xs text-slate-400 font-sans">${i.unit}</span></div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide border ${i.stock === 0 ? 'bg-red-100 text-red-700 border-red-200' : (i.stock < i.min ? 'bg-orange-100 text-orange-700 border-orange-200' : 'bg-green-100 text-green-700 border-green-200')}">
                            ${i.stock === 0 ? 'Out of Stock' : (i.stock < i.min ? 'Low Stock' : 'In Stock')}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-slate-500 dark:text-slate-400">${i.loc}</td>
                    <td class="px-6 py-4 text-right">
                        <div class="flex justify-end gap-2 opacity-100 lg:opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="updateStock(${i.id}, 1)" class="w-8 h-8 rounded-lg bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 hover:scale-110 transition flex items-center justify-center"><i class="fa-solid fa-plus text-xs"></i></button>
                            <button onclick="updateStock(${i.id}, -1)" class="w-8 h-8 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:scale-110 transition flex items-center justify-center"><i class="fa-solid fa-minus text-xs"></i></button>
                            <div class="w-px h-6 bg-slate-200 dark:bg-slate-700 mx-1"></div>
                            <button onclick="openModal(${i.id})" class="w-8 h-8 rounded-lg bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:scale-110 transition flex items-center justify-center"><i class="fa-solid fa-pen text-xs"></i></button>
                            <button onclick="delItem(${i.id})" class="w-8 h-8 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-500 hover:text-red-500 hover:scale-110 transition flex items-center justify-center"><i class="fa-solid fa-trash text-xs"></i></button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // ==========================================
        // SECTION 6: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Modal & CRUD (Create, Read, Update, Delete)
        // ==========================================
        
        // ‡πÄ‡∏õ‡∏¥‡∏î Modal (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
        function openModal(id = null) {
            const modal = document.getElementById('modal-form');
            const title = document.getElementById('modal-title');
            
            if(id) {
                // === ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (Edit) ===
                const item = inventory.find(i => i.id === id); // ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
                if(!item) return;
                title.innerText = 'Edit Item';
                // ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô Input
                document.getElementById('inp-id').value = item.id;
                document.getElementById('inp-name').value = item.name;
                document.getElementById('inp-sku').value = item.sku;
                document.getElementById('inp-loc').value = item.loc;
                document.getElementById('inp-stock').value = item.stock;
                document.getElementById('inp-min').value = item.min;
                document.getElementById('inp-unit').value = item.unit;
            } else {
                // === ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà (Add) ===
                title.innerText = 'Add New Item';
                document.querySelector('form').reset(); // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                document.getElementById('inp-id').value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå ID
            }
            
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-form').classList.add('hidden');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏£‡∏ß‡∏° Add ‡πÅ‡∏•‡∏∞ Edit ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
        function handleFormSubmit() {
            const idVal = document.getElementById('inp-id').value;
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Object ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å Input
            const newItem = {
                id: idVal ? parseInt(idVal) : Date.now(), // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ID ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏î‡∏¥‡∏° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
                name: document.getElementById('inp-name').value,
                sku: document.getElementById('inp-sku').value,
                stock: parseInt(document.getElementById('inp-stock').value),
                min: parseInt(document.getElementById('inp-min').value),
                unit: document.getElementById('inp-unit').value,
                loc: document.getElementById('inp-loc').value
            };

            if(idVal) {
                // Update ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
                const index = inventory.findIndex(i => i.id === newItem.id);
                if(index !== -1) {
                    inventory[index] = newItem;
                    addLog('Item Updated', `Edited ${newItem.name}`);
                    showToast('Item updated successfully');
                }
            } else {
                // Add ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤ Array
                inventory.push(newItem);
                addLog('New Item', `Added ${newItem.name}`);
                showToast('New item added');
            }

            save(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            closeModal();
            if(currRoute === 'inventory') renderInvTable(); // ‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
        }

        // ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function delItem(id) {
            if(confirm('Delete this item?')) {
                const name = inventory.find(i => i.id === id)?.name;
                inventory = inventory.filter(i => i.id !== id); // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤ ID ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ
                save();
                addLog('Item Deleted', `Removed ${name}`);
                renderInvTable();
                showToast('Item deleted');
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏î‡πà‡∏ß‡∏ô
        function updateStock(id, amt) {
            const item = inventory.find(i => i.id === id);
            if(item) {
                item.stock = Math.max(0, item.stock + amt); // ‡∏´‡πâ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏•‡∏ö
                save();
                addLog('Stock Update', `${item.name}: ${amt>0?'+':''}${amt} (${item.stock})`);
                if(currRoute==='inventory') renderInvTable();
                showToast(`Stock updated: ${item.stock}`);
            }
        }

        // ==========================================
        // SECTION 7: ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏° (Export, Save, Log, Toast, Chart)
        // ==========================================
        
        // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV (Excel)
        function exportCSV() {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Header ‡πÅ‡∏•‡∏∞ Loop ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô String
            let csv = "ID,Name,SKU,Stock,Unit,Location\n" + inventory.map(i => `${i.id},"${i.name}",${i.sku},${i.stock},${i.unit},"${i.loc}"`).join('\n');
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([csv], {type: 'text/csv'}));
            a.download = 'inventory_export.csv';
            a.click();
            showToast('CSV Exported');
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á LocalStorage
        function save() {
            localStorage.setItem('factory_inv_v2', JSON.stringify(inventory));
            localStorage.setItem('factory_logs_v2', JSON.stringify(activityLogs));
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏à‡∏≥‡∏Å‡∏±‡∏î 20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
        function addLog(action, desc) {
            activityLogs.unshift({ action, desc, time: new Date().toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit'}) });
            if(activityLogs.length > 20) activityLogs.pop();
            save();
        }

        function clearLogs() {
            activityLogs = [];
            save();
            if(currRoute === 'dashboard') renderDashboard(document.getElementById('content-area'));
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô
        function showToast(msg, type='success') {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.style.transform = 'translateX(0)'; // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
            setTimeout(() => t.style.transform = 'translateX(150%)', 2500); // ‡∏´‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á 2.5 ‡∏ß‡∏¥
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü (‡πÉ‡∏ä‡πâ Chart.js)
        function initCharts(lowCount) {
            const ctx = document.getElementById('chartProd').getContext('2d');
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏µ‡πÑ‡∏•‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö (Gradient)
            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(59, 130, 246, 0.5)');
            gradient.addColorStop(1, 'rgba(59, 130, 246, 0.0)');

            // ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏™‡πâ‡∏ô
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['8:00', '10:00', '12:00', '14:00', '16:00', '18:00'],
                    datasets: [{
                        label: 'Output', data: [120, 350, 480, 600, 850, 920],
                        borderColor: '#3b82f6', backgroundColor: gradient, fill: true, tension: 0.4,
                        pointBackgroundColor: '#fff', pointBorderColor: '#3b82f6', pointBorderWidth: 2
                    }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { grid: { color: isDarkMode ? '#334155' : '#e2e8f0' } } } }
            });

            // ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏° (Doughnut)
            new Chart(document.getElementById('chartInv'), {
                type: 'doughnut',
                data: {
                    labels: ['In Stock', 'Low Stock', 'Empty'],
                    datasets: [{ data: [inventory.filter(i=>i.stock>=i.min).length, lowCount, inventory.filter(i=>i.stock===0).length], backgroundColor: ['#10b981', '#f59e0b', '#ef4444'], borderWidth: 0 }]
                },
                options: { plugins: { legend: { position: 'right' } } }
            });
        }

        // Render ‡∏´‡∏ô‡πâ‡∏≤ Production (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á)
        function renderProduction(el) {
            // Helper ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (Arrow Function ‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠)
            const m = (n,s,e,t,c) => `<div class="bg-white dark:bg-slate-800 border dark:border-slate-700 rounded-xl p-6 flex flex-col md:flex-row items-center gap-6 shadow-sm"><div class="w-16 h-16 rounded-full bg-${c}-100 dark:bg-${c}-900/30 flex items-center justify-center text-2xl text-${c}-600 dark:text-${c}-400 ${s==='Running'?'animate-pulse':''}"><i class="fa-solid fa-gears"></i></div><div class="flex-1 w-full"><div class="flex justify-between mb-2"><h3 class="font-bold text-lg dark:text-white">${n}</h3><span class="px-3 py-1 rounded-full text-xs font-bold uppercase bg-${c}-100 dark:bg-${c}-900/30 text-${c}-700 dark:text-${c}-400">${s}</span></div><div class="w-full bg-slate-100 dark:bg-slate-700 rounded-full h-2.5 overflow-hidden"><div class="bg-${c}-500 h-2.5 rounded-full" style="width: ${e}%"></div></div><div class="flex justify-between mt-2 text-xs text-slate-500"><span>EFF: ${e}%</span> <span>TEMP: ${t}¬∞C</span></div></div></div>`;
            el.innerHTML = `<div class="space-y-6 fade-in"><h2 class="text-2xl font-bold dark:text-white mb-6">Production Monitor</h2><div class="grid gap-4">${m('CNC Machine A','Running',92,65,'green')}${m('Robot Arm B','Running',88,50,'green')}${m('Conveyor Belt','Stopped',0,25,'red')}</div></div>`;
        }

        // Render ‡∏´‡∏ô‡πâ‡∏≤ Scanner (‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≥‡∏•‡∏≠‡∏á)
        function renderBarcode(el) {
            el.innerHTML = `<div class="max-w-4xl mx-auto space-y-8 fade-in text-center"><h2 class="text-3xl font-bold dark:text-white">Scanner Terminal</h2><p class="text-slate-500">Simulation Mode</p><div class="bg-slate-900 p-8 rounded-3xl text-white">üì∑ Camera Feed Simulated</div></div>`;
        }

    </script>
</body>
</html>